<!DOCTYPE html>
<html lang="ar" dir="rtl" id="mainHtml">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MONOFLIX | BENSENOUCI MOUNDIR</title>
    <style>
        :root { --red: #e50914; --black: #050505; --dark: #121212; }
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background: var(--black); color: white; overflow-x: hidden; scroll-behavior: smooth; }
        
        /* Header & Navigation */
        header { position: fixed; top: 0; width: 100%; z-index: 1000; display: flex; justify-content: space-between; align-items: center; padding: 10px 5%; background: rgba(0,0,0,0.9); backdrop-filter: blur(10px); border-bottom: 1px solid #222; }
        .logo-box { display: flex; align-items: center; gap: 10px; cursor: pointer; }
        .logo-img { width: 35px; border-radius: 8px; box-shadow: 0 0 10px var(--red); }
        .brand-info h1 { color: var(--red); font-size: 16px; }
        .nav-bar { margin-top: 75px; padding: 15px 5%; display: flex; gap: 12px; overflow-x: auto; scrollbar-width: none; scroll-behavior: smooth; }
        .nav-bar::-webkit-scrollbar { display: none; }
        .btn-nav { padding: 10px 20px; background: #1a1a1a; border-radius: 25px; cursor: pointer; white-space: nowrap; border: 1px solid #333; color: white; transition: 0.3s; font-size: 14px; }
        .btn-nav.active { background: var(--red); border-color: var(--red); transform: scale(1.05); }

        /* Grid System */
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 15px; padding: 10px 5%; }
        .card { cursor: pointer; border-radius: 12px; overflow: hidden; background: var(--dark); transition: 0.4s; border: 1px solid transparent; }
        .card:hover { transform: translateY(-5px); border-color: var(--red); }
        .card img { width: 100%; height: 210px; object-fit: cover; display: block; }
        .card-info { padding: 10px; font-size: 12px; text-align: center; font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

        /* Modal & Player */
        .modal { position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.95); display:none; z-index:2000; overflow-y: auto; padding: 20px 0; }
        .info-content { max-width: 900px; margin: auto; background: #111; border-radius: 20px; overflow: hidden; position: relative; border: 1px solid #333; animation: fadeIn 0.4s; }
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }
        .close-btn { position: absolute; top: 15px; right: 15px; width: 35px; height: 35px; background: var(--red); border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; z-index: 10; }
        .info-header { display: flex; gap: 25px; padding: 30px; flex-wrap: wrap; }
        .info-poster { width: 220px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .info-details { flex: 1; min-width: 300px; }
        .btn-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(60px, 1fr)); gap: 8px; margin-top: 10px; }
        .btn-item { background: #222; border: 1px solid #444; color: white; padding: 8px; border-radius: 8px; cursor: pointer; text-align: center; font-size: 12px; transition: 0.2s; }
        .btn-item.selected { background: var(--red); border-color: var(--red); }
        #videoLayer { position: fixed; top:0; left:0; width:100%; height:100%; background: #000; display:none; z-index:3000; flex-direction: column; }
        iframe { flex: 1; border: none; }
        footer { padding: 30px; text-align: center; background: #080808; font-size: 13px; color: #666; }
    </style>
</head>
<body>

<header>
    <div class="logo-box" onclick="location.reload()">
        <img src="https://t3.ftcdn.net/jpg/05/90/75/40/360_F_590754013_9PdsotqXpLpIsYJ6atpZ6y9mZInI3T5C.jpg" class="logo-img">
        <div class="brand-info"><h1>MONOFLIX</h1><span id="devBy">BY MOUNDIR</span></div>
    </div>
    <div style="display: flex; gap: 10px;">
        <select id="langToggle" onchange="changeLanguage()" style="background:#111; color:white; border:1px solid #333; padding:5px; border-radius:5px;">
            <option value="ar-SA">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
            <option value="en-US">English</option>
        </select>
        <input type="text" id="searchInput" placeholder="..." style="padding:8px; border-radius:20px; border:1px solid #333; background:#111; color:white; width:100px;">
    </div>
</header>

<div class="nav-bar" id="mainNav">
    <div class="btn-nav active" data-id="trending" onclick="changeCategory('trending', event)">ðŸ”¥</div>
    <div class="btn-nav" data-id="28" onclick="changeCategory(28, event)">Action</div>
    <div class="btn-nav" data-id="16" onclick="changeCategory(16, event)">Animation</div>
    <div class="btn-nav" data-id="27" onclick="changeCategory(27, event)">Horror</div>
    <div class="btn-nav" data-id="35" onclick="changeCategory(35, event)">Comedy</div>
</div>

<div class="grid" id="mainGrid"></div>
<div id="sentinel" style="height: 20px;"></div>

<div class="modal" id="infoModal">
    <div class="info-content">
        <div class="close-btn" onclick="closeModal('infoModal')">âœ•</div>
        <div class="info-header">
            <img id="modalPoster" class="info-poster">
            <div class="info-details">
                <h2 id="modalTitle"></h2>
                <p id="modalDesc" style="margin: 15px 0; color: #ccc; font-size: 14px; line-height: 1.6;"></p>
                <div id="tvSelectors" style="display:none;">
                    <h4 id="txtSeason">Ø§Ù„Ù…ÙˆØ§Ø³Ù…:</h4>
                    <div id="seasonsGrid" class="btn-grid"></div>
                    <h4 id="txtEpisode" style="margin-top:15px;">Ø§Ù„Ø­Ù„Ù‚Ø§Øª:</h4>
                    <div id="episodesGrid" class="btn-grid"></div>
                </div>
                <button class="btn-nav active" style="width:100%; margin-top:20px; background:var(--red);" onclick="showPlayer()">â–¶ <span id="txtWatch">Ù…Ø´Ø§Ù‡Ø¯Ø©</span></button>
            </div>
        </div>
    </div>
</div>

<div id="videoLayer">
    <div style="padding:15px; background:#111; display:flex; justify-content:space-between;">
        <select id="serverSelect" onchange="switchServer()" style="background:#222; color:white; padding:5px;">
            <option value="vidsrc">Server 1</option>
            <option value="vidsrc_cc">Server 2</option>
        </select>
        <span onclick="closeModal('videoLayer')" style="color:var(--red); cursor:pointer; font-weight:bold;">âœ• Ø¥ØºÙ„Ø§Ù‚</span>
    </div>
    <iframe id="mainIframe" allowfullscreen></iframe>
</div>

<footer>Developed by Bensenouci Moundir Â© 2026</footer>

<script>
    let currentLang = localStorage.getItem('monoflix_lang') || 'ar-SA';
    let currentGenre = 'trending', currentPage = 1, isFetching = false, currentItem = {};
    let selectedS = 1, selectedE = 1;

    const dict = {
        'ar-SA': { watch: 'Ù…Ø´Ø§Ù‡Ø¯Ø©', season: 'Ø§Ù„Ù…ÙˆØ§Ø³Ù…:', episode: 'Ø§Ù„Ø­Ù„Ù‚Ø§Øª:', search: 'Ø§Ø¨Ø­Ø«...', action: 'Ø£ÙƒØ´Ù†', anime: 'Ø£Ù†ÙŠÙ…ÙŠØ´Ù†', horror: 'Ø±Ø¹Ø¨', comedy: 'ÙƒÙˆÙ…ÙŠØ¯ÙŠ' },
        'en-US': { watch: 'Watch', season: 'Seasons:', episode: 'Episodes:', search: 'Search...', action: 'Action', anime: 'Anime', horror: 'Horror', comedy: 'Comedy' }
    };

    function updateUI() {
        const d = dict[currentLang];
        document.getElementById('mainHtml').dir = currentLang === 'ar-SA' ? 'rtl' : 'ltr';
        document.getElementById('txtWatch').innerText = d.watch;
        document.getElementById('txtSeason').innerText = d.season;
        document.getElementById('txtEpisode').innerText = d.episode;
        document.getElementById('searchInput').placeholder = d.search;
        document.querySelector('[data-id="28"]').innerText = d.action;
        document.querySelector('[data-id="16"]').innerText = d.anime;
        document.querySelector('[data-id="27"]').innerText = d.horror;
        document.querySelector('[data-id="35"]').innerText = d.comedy;
    }

    async function loadMovies(append = false) {
        if (isFetching) return;
        isFetching = true;
        const res = await fetch(`/api/movies?genre=${currentGenre}&page=${currentPage}&lang=${currentLang}`);
        const data = await res.json();
        render(data.results, append);
        isFetching = false;
    }

    function render(list, append) {
        const html = list.map(item => `
            <div class="card" onclick='showDetails(${JSON.stringify(item).replace(/'/g, "&apos;")})'>
                <img src="https://image.tmdb.org/t/p/w342${item.poster_path}" alt="">
                <div class="card-info">${item.title || item.name}</div>
            </div>`).join('');
        const grid = document.getElementById('mainGrid');
        grid.innerHTML = append ? grid.innerHTML + html : html;
    }

    async function showDetails(item) {
        currentItem = item;
        document.getElementById('modalPoster').src = 'https://image.tmdb.org/t/p/w500' + item.poster_path;
        document.getElementById('modalTitle').innerText = item.title || item.name;
        document.getElementById('modalDesc').innerText = item.overview || "...";
        document.getElementById('infoModal').style.display = 'block';

        if (item.name) { // Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…Ø³Ù„Ø³Ù„Ø§Ù‹
            document.getElementById('tvSelectors').style.display = 'block';
            loadSeasons(item.id);
        } else {
            document.getElementById('tvSelectors').style.display = 'none';
        }
    }

    async function loadSeasons(id) {
        const res = await fetch(`/api/movies?type=tv&id=${id}&lang=${currentLang}`);
        const data = await res.json();
        const html = data.seasons.filter(s => s.season_number > 0).map(s => 
            `<div class="btn-item ${s.season_number==1?'selected':''}" onclick="selectS(${s.season_number}, this)">S${s.season_number}</div>`
        ).join('');
        document.getElementById('seasonsGrid').innerHTML = html;
        selectS(1);
    }

    async function selectS(sNum, el) {
        selectedS = sNum;
        if(el) {
            document.querySelectorAll('#seasonsGrid .btn-item').forEach(b => b.classList.remove('selected'));
            el.classList.add('selected');
        }
        const res = await fetch(`/api/movies?type=tv&id=${currentItem.id}&season=${sNum}&lang=${currentLang}`);
        const data = await res.json();
        const html = data.episodes.map(e => 
            `<div class="btn-item" onclick="selectE(${e.episode_number}, this)">E${e.episode_number}</div>`
        ).join('');
        document.getElementById('episodesGrid').innerHTML = html;
    }

    function selectE(eNum, el) {
        selectedE = eNum;
        document.querySelectorAll('#episodesGrid .btn-item').forEach(b => b.classList.remove('selected'));
        el.classList.add('selected');
    }

    function showPlayer() {
        switchServer();
        document.getElementById('videoLayer').style.display = 'flex';
    }

    function switchServer() {
        const s = document.getElementById('serverSelect').value;
        const type = currentItem.title ? 'movie' : 'tv';
        let url = s === 'vidsrc' 
            ? `https://vidsrc.to/embed/${type}/${currentItem.id}`
            : `https://vidsrc.cc/v2/embed/${type}/${currentItem.id}`;
        
        if(type === 'tv') url += s === 'vidsrc' ? `/${selectedS}/${selectedE}` : `/${selectedS}/${selectedE}`;
        document.getElementById('mainIframe').src = url;
    }

    function changeCategory(g, e) {
        currentGenre = g; currentPage = 1;
        document.querySelectorAll('.btn-nav').forEach(b => b.classList.remove('active'));
        e.target.classList.add('active');
        loadMovies();
    }

    function changeLanguage() {
        currentLang = document.getElementById('langToggle').value;
        localStorage.setItem('monoflix_lang', currentLang);
        updateUI();
        loadMovies();
    }

    function closeModal(id) {
        document.getElementById(id).style.display = 'none';
        if(id === 'videoLayer') document.getElementById('mainIframe').src = '';
    }

    document.getElementById('searchInput').oninput = async (e) => {
        if(e.target.value.length < 3) return;
        const res = await fetch(`/api/movies?query=${e.target.value}&lang=${currentLang}`);
        const data = await res.json();
        render(data.results, false);
    };

    // Infinite Scroll
    window.onscroll = () => {
        if ((window.innerHeight + window.scrollY) >= document.body.offsetHeight - 500 && !isFetching) {
            currentPage++;
            loadMovies(true);
        }
    };

    window.onload = () => { updateUI(); loadMovies(); };
</script>
</body>
</html>