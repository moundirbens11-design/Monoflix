<!DOCTYPE html>
<html lang="ar" dir="rtl" id="mainHtml">
<head>
    <meta name="theme-color" content="#050505">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MONOFLIX PRO | BY BENSENOUCI MOUNDIR</title>
    <link rel="icon" type="image/png" href="https://t3.ftcdn.net/jpg/05/90/75/40/360_F_590754013_9PdsotqXpLpIsYJ6atpZ6y9mZInI3T5C.jpg">
      <style>

        :root { --red: #e50914; --black: #050505; --dark: #121212; --yellow: #f5c518; --green: #28a745; --gray: #888; }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', sans-serif; -webkit-tap-highlight-color: transparent; }

        body { background: var(--black); color: white; overflow-x: hidden; scroll-behavior: smooth; }

       

        header { position: fixed; top: 0; width: 100%; z-index: 1000; display: flex; justify-content: space-between; align-items: center; padding: 12px 5%; background: rgba(0,0,0,0.95); backdrop-filter: blur(15px); border-bottom: 1px solid #222; }

        .logo-box { display: flex; align-items: center; gap: 12px; cursor: pointer; }

        .logo-img { width: 40px; border-radius: 10px; box-shadow: 0 0 15px var(--red); }

        .brand-info h1 { color: var(--red); font-size: 20px; margin: 0; }

        .brand-info span { font-size: 10px; color: var(--gray); display: block; }



        .notif-box { position: relative; cursor: pointer; margin-right: 15px; }

        .notif-dot { position: absolute; top: -2px; right: -2px; width: 8px; height: 8px; background: var(--red); border-radius: 50%; display: none; }



        .nav-bar { margin-top: 85px; padding: 15px 5%; display: flex; gap: 12px; overflow-x: auto; scrollbar-width: none; }

        .nav-bar::-webkit-scrollbar { display: none; }

        .btn-nav { padding: 10px 22px; background: #1a1a1a; border-radius: 30px; cursor: pointer; white-space: nowrap; border: 1px solid #333; color: white; transition: 0.3s; font-size: 13px; font-weight: 600; }

        .btn-nav.active { background: var(--red); border-color: var(--red); box-shadow: 0 4px 15px rgba(229, 9, 20, 0.4); }



        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 20px; padding: 20px 5% 50px; }

        .card { cursor: pointer; border-radius: 15px; overflow: hidden; background: var(--dark); transition: 0.4s; border: 1px solid #222; position: relative; }

        .card:hover { transform: translateY(-10px); border-color: var(--red); }

        .card img { width: 100%; height: 230px; object-fit: cover; }

       

        .badge-rate { position: absolute; top: 10px; left: 10px; background: rgba(0,0,0,0.85); padding: 3px 8px; border-radius: 6px; font-size: 11px; color: var(--yellow); font-weight: bold; border: 1px solid #444; }

        .badge-year { position: absolute; top: 10px; right: 10px; background: var(--red); color: white; padding: 3px 8px; border-radius: 6px; font-size: 11px; font-weight: bold; }

        .card-info { padding: 12px; font-size: 12px; text-align: center; font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }



        .modal { position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.98); display:none; z-index:2000; overflow-y: auto; padding: 40px 0; }

        .info-content { max-width: 900px; margin: auto; background: #0f0f0f; border-radius: 25px; overflow: hidden; position: relative; border: 1px solid #333; animation: slideUp 0.4s; }

        @keyframes slideUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }

       

        .close-btn { position: absolute; top: 20px; right: 20px; width: 40px; height: 40px; background: var(--red); border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; z-index: 10; font-weight: bold; }

        .info-header { display: flex; gap: 30px; padding: 40px; flex-wrap: wrap; }

        .info-poster { width: 250px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }

        .info-details { flex: 1; min-width: 300px; }

       

        .btn-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(65px, 1fr)); gap: 10px; margin-top: 15px; max-height: 150px; overflow-y: auto; }

        .btn-item { background: #1a1a1a; border: 1px solid #333; color: white; padding: 10px; border-radius: 10px; cursor: pointer; text-align: center; font-size: 12px; }

        .btn-item.selected { background: var(--red); border-color: var(--red); font-weight: bold; }



        .similar-section { padding: 30px 40px; border-top: 1px solid #222; }

        .similar-grid { display: flex; gap: 15px; overflow-x: auto; padding-bottom: 10px; }

        .similar-card { min-width: 120px; cursor: pointer; }

        .similar-card img { width: 120px; height: 180px; border-radius: 12px; object-fit: cover; }

       

        #videoLayer { position: fixed; top:0; left:0; width:100%; height:100%; background: #000; display:none; z-index:3000; flex-direction: column; }

        .player-header { padding: 15px 5%; background: #111; display: flex; justify-content: space-between; align-items: center; }
        iframe { flex: 1; border: none; background: #000; }
        footer { padding: 40px; text-align: center; background: #080808; font-size: 14px; color: #666; border-top: 1px solid #222; }
        /* --- Ø£Ø¶Ù Ù‡Ø°Ø§ Ø§Ù„Ø¬Ø²Ø¡ ÙÙŠ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù€ Style --- */
@media (max-width: 600px) {
    /* Ø¬Ø¹Ù„ Ø§Ù„Ø£ÙÙ„Ø§Ù… ØªØ¸Ù‡Ø± ÙÙŠ Ø¹Ù…ÙˆØ¯ÙŠÙ† Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ø§Ù„ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø¹Ø´ÙˆØ§Ø¦ÙŠ */
    .grid { 
        grid-template-columns: repeat(2, 1fr) !important; 
        gap: 10px !important; 
        padding: 15px 3% !important; 
    }
    
    /* ØªØµØºÙŠØ± Ø­Ø¬Ù… Ø§Ù„Ù‡ÙŠØ¯Ø± (Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙˆØ§Ù„Ù„ÙˆØ¬Ùˆ) Ù„ÙŠÙˆÙØ± Ù…Ø³Ø§Ø­Ø© */
    header { padding: 10px 3% !important; }
    .brand-info h1 { font-size: 16px !important; }
    .logo-img { width: 30px !important; }
    
    /* Ø¬Ø¹Ù„ Ù†Ø§ÙØ°Ø© Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ÙÙŠÙ„Ù… ØªØ¸Ù‡Ø± Ø¨Ø´ÙƒÙ„ Ø·ÙˆÙ„ÙŠ ÙˆÙ…Ù†Ø§Ø³Ø¨ Ù„Ù„Ø´Ø§Ø´Ø© Ø§Ù„ØµØºÙŠØ±Ø© */
    .info-header { 
        padding: 20px !important; 
        flex-direction: column !important; 
        align-items: center !important; 
        text-align: center !important; 
    }
    
    .info-poster { width: 160px !important; }
    
    .info-details { 
        min-width: 100% !important; 
    }

    /* ØªØµØºÙŠØ± Ø´Ø±ÙŠØ· Ø§Ù„Ø¨Ø­Ø« Ù‚Ù„ÙŠÙ„Ø§Ù‹ */
    #searchInput { width: 80px !important; font-size: 11px !important; }
}
    </style>
</head>
<body>

<header>
    <div class="logo-box" onclick="location.reload()">
        <img src="https://t3.ftcdn.net/jpg/05/90/75/40/360_F_590754013_9PdsotqXpLpIsYJ6atpZ6y9mZInI3T5C.jpg" class="logo-img">
        <div class="brand-info">
            <h1>MONOFLIX</h1>
            <span>BY BENSENOUCI MOUNDIR</span>
        </div>
    </div>
    <div style="display: flex; gap: 10px; align-items: center;">
        <div class="notif-box" onclick="alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø¬Ø¯ÙŠØ¯Ø© Ø­Ø§Ù„ÙŠØ§Ù‹ - Ù…ÙˆÙ‚Ø¹Ùƒ Ù…Ø­Ø¯Ø«!')">
            <span style="font-size: 20px;">ğŸ””</span>
            <div class="notif-dot" id="notifDot" style="display: block;"></div>
        </div>
        <select id="langToggle" onchange="changeLanguage()" style="background:#111; color:white; border:1px solid #333; padding:6px; border-radius:8px; font-size:12px; cursor:pointer;">
            <option value="ar-SA">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
            <option value="en-US">English</option>
        </select>
        <input type="text" id="searchInput" placeholder="Ø§Ø¨Ø­Ø«..." style="padding:8px 15px; border-radius:20px; border:1px solid #333; background:#111; color:white; width:130px; outline:none;">
    </div>
</header>

<div class="nav-bar" id="mainNav">
    <div class="btn-nav active" data-id="trending" id="navAll" onclick="changeCategory('trending', event)">ğŸ”¥ Ø§Ù„ÙƒÙ„</div>
    <div class="btn-nav" data-id="top_rated" id="navPopular" onclick="changeCategory('top_rated', event)">ğŸ” Ø§Ù„Ø£ÙƒØ«Ø± Ù…Ø´Ø§Ù‡Ø¯Ø©</div>
    <div class="btn-nav" data-id="28" onclick="changeCategory(28, event)">Action</div>
    <div class="btn-nav" data-id="27" onclick="changeCategory(27, event)">Horror</div>
    <div class="btn-nav" data-id="16" onclick="changeCategory(16, event)">Anime</div>
    <div class="btn-nav" id="navFav" onclick="showWatchlist(event)">â¤ï¸ Ø§Ù„Ù…ÙØ¶Ù„Ø§Øª</div>
    <div class="btn-nav" id="navHist" onclick="showHistory(event)">ğŸ•’ Ø§Ù„Ø£Ø®ÙŠØ±Ø©</div>
</div>

<h3 id="continueTitle" style="margin: 20px 5% 0; display:none; color: var(--red); font-size: 18px;">ğŸ¬ Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø©</h3>
<div class="nav-bar" id="continueGrid" style="display:none; padding-top:10px; margin-top: 10px;"></div>

<div class="grid" id="mainGrid"></div>

<div class="modal" id="infoModal">
    <div class="info-content">
        <div class="close-btn" onclick="closeModal('infoModal')">âœ•</div>
        <div class="info-header">
            <img id="modalPoster" class="info-poster">
            <div class="info-details">
                <h2 id="modalTitle"></h2>
                <div id="modalMeta" style="margin:10px 0; font-size:14px; color:var(--yellow); font-weight:bold;"></div>
                <p id="modalDesc" style="margin: 20px 0; color: #ccc; font-size: 15px; line-height: 1.7;"></p>
                <div id="tvSelectors" style="display:none;">
                    <h4 id="txtSeason">Ø§Ù„Ù…ÙˆØ§Ø³Ù…:</h4><div id="seasonsGrid" class="btn-grid"></div>
                    <h4 id="txtEpisode" style="margin-top:20px;">Ø§Ù„Ø­Ù„Ù‚Ø§Øª:</h4><div id="episodesGrid" class="btn-grid"></div>
                </div>
                <div style="display:flex; gap:12px; margin-top:25px; flex-wrap: wrap;">
                    <button class="btn-nav active" style="flex:2; background:var(--red); height:45px;" onclick="watchNow()">â–¶ <span id="txtWatch">Ù…Ø´Ø§Ù‡Ø¯Ø©</span></button>
                    <button class="btn-nav" style="flex:1; background:var(--green); border-color:var(--green);" onclick="downloadNow()">â¬‡ï¸ ØªØ­Ù…ÙŠÙ„</button>
                    <button class="btn-nav" style="flex:1; background:#333; border-color:#444;" onclick="copyLink()">ğŸ”— Ù…Ø´Ø§Ø±ÙƒØ©</button>
                    <button class="btn-nav" id="favBtn" onclick="toggleWatchlist()" style="flex:0.5;">â¤ï¸</button>
                </div>
            </div>
        </div>
        <div class="similar-section"><h3 id="txtSimilar">Ù…Ø­ØªÙˆÙ‰ Ù…Ø´Ø§Ø¨Ù‡</h3><div id="similarGrid" class="similar-grid"></div></div>
    </div>
</div>

<div id="videoLayer">
    <div class="player-header">
  <select id="serverSelect" onchange="switchServer()">
    <option value="vidsrc_me">Ø§Ù„Ø³ÙŠØ±ÙØ± Ø§Ù„Ø³Ø±ÙŠØ¹ (Vidsrc)</option>
    <option value="uqload">Ø³ÙŠØ±ÙØ± UQLOAD (Ø³Ø±ÙŠØ¹)</option> 
    <option value="superembed">Ø³ÙŠØ±ÙØ± Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø¨Ø§Ø´Ø± (Multi)</option>
    <option value="smashy">Ø³ÙŠØ±ÙØ± Ø¨Ø¯ÙŠÙ„ (Smashy)</option>
    <option value="2embed">Ø³ÙŠØ±ÙØ± Ø§Ø­ØªÙŠØ§Ø·ÙŠ (2Embed)</option>
</select>
        <span onclick="closeModal('videoLayer')" style="color:var(--red); cursor:pointer; font-weight:bold; background:rgba(229,9,20,0.1); padding:8px 15px; border-radius:8px;">âœ• Ø¥ØºÙ„Ø§Ù‚</span>
    </div>
   <iframe id="mainIframe" allowfullscreen referrerpolicy="origin"></iframe>
</div>

<footer>
    Developed with â¤ï¸ by <span style="color: var(--red); font-weight: bold;">Bensenouci Moundir</span> Â© 2026
</footer>

<script>
    let currentLang = localStorage.getItem('monoflix_lang') || 'ar-SA';
    let watchlist = JSON.parse(localStorage.getItem('monoflix_fav')) || [];
    let history = JSON.parse(localStorage.getItem('monoflix_history')) || [];
    let currentGenre = 'trending', currentPage = 1, isFetching = false, currentItem = {};
    let selectedS = 1, selectedE = 1;

    const uiTexts = {
        'ar-SA': { search: 'Ø§Ø¨Ø­Ø«...', navAll: 'ğŸ”¥ Ø§Ù„ÙƒÙ„', navPopular: 'ğŸ” Ø§Ù„Ø£ÙƒØ«Ø± Ù…Ø´Ø§Ù‡Ø¯Ø©', navFav: 'â¤ï¸ Ø§Ù„Ù…ÙØ¶Ù„Ø§Øª', navHist: 'ğŸ•’ Ø§Ù„Ø£Ø®ÙŠØ±Ø©', txtSeason: 'Ø§Ù„Ù…ÙˆØ§Ø³Ù…:', txtEpisode: 'Ø§Ù„Ø­Ù„Ù‚Ø§Øª:', txtWatch: 'Ù…Ø´Ø§Ù‡Ø¯Ø©', txtDown: 'ØªØ­Ù…ÙŠÙ„', txtSimilar: 'Ù…Ø­ØªÙˆÙ‰ Ù…Ø´Ø§Ø¨Ù‡' },
        'en-US': { search: 'Search...', navAll: 'ğŸ”¥ All', navPopular: 'ğŸ” Trending', navFav: 'â¤ï¸ Favorites', navHist: 'ğŸ•’ History', txtSeason: 'Seasons:', txtEpisode: 'Episodes:', txtWatch: 'Watch', txtDown: 'Download', txtSimilar: 'Similar Content' }
    };

    function applyLang() {
        const texts = uiTexts[currentLang];
        if(document.getElementById('searchInput')) document.getElementById('searchInput').placeholder = texts.search;
        if(document.getElementById('navAll')) document.getElementById('navAll').innerText = texts.navAll;
        if(document.getElementById('navPopular')) document.getElementById('navPopular').innerText = texts.navPopular;
        if(document.getElementById('navFav')) document.getElementById('navFav').innerText = texts.navFav;
        if(document.getElementById('navHist')) document.getElementById('navHist').innerText = texts.navHist;
        if(document.getElementById('txtSeason')) document.getElementById('txtSeason').innerText = texts.txtSeason;
        if(document.getElementById('txtEpisode')) document.getElementById('txtEpisode').innerText = texts.txtEpisode;
        if(document.getElementById('txtWatch')) document.getElementById('txtWatch').innerText = texts.txtWatch;
        if(document.getElementById('txtSimilar')) document.getElementById('txtSimilar').innerText = texts.txtSimilar;
        if(document.getElementById('langToggle')) document.getElementById('langToggle').value = currentLang;
        if(document.getElementById('mainHtml')) document.getElementById('mainHtml').dir = currentLang === 'ar-SA' ? 'rtl' : 'ltr';
    }

    async function loadMovies(append = false) {
        if (isFetching || currentGenre === 'watchlist' || currentGenre === 'history') return;
        isFetching = true;
        try {
            const res = await fetch(`/api/movies?genre=${currentGenre}&page=${currentPage}&lang=${currentLang}`);
            const data = await res.json();
            render(data.results, append);
        } catch (e) { console.error("Error loading movies"); }
        isFetching = false;
    }

    function render(list, append) {
        if (!list) return;
        const html = list.filter(i => i.poster_path).map(item => {
            const year = (item.release_date || item.first_air_date || '').split('-')[0];
            const rate = item.vote_average ? item.vote_average.toFixed(1) : '0';
            return `<div class="card" onclick='showDetails(${JSON.stringify(item).replace(/'/g, "&apos;")})'>
                <div class="badge-rate">â­ ${rate}</div><div class="badge-year">${year}</div>
                <img src="https://image.tmdb.org/t/p/w342${item.poster_path}" loading="lazy">
                <div class="card-info">${item.title || item.name}</div>
            </div>`;
        }).join('');
        const grid = document.getElementById('mainGrid');
        grid.innerHTML = append ? grid.innerHTML + html : html;
    }

    async function showDetails(item) {
        currentItem = item;
        document.getElementById('modalPoster').src = 'https://image.tmdb.org/t/p/w500' + item.poster_path;
        document.getElementById('modalTitle').innerText = item.title || item.name;
        document.getElementById('modalDesc').innerText = item.overview || "...";
        document.getElementById('modalMeta').innerText = `â­ ${item.vote_average.toFixed(1)} | ${item.release_date || item.first_air_date}`;
        document.getElementById('infoModal').style.display = 'block';
        document.body.style.overflow = 'hidden';
        const isFav = watchlist.some(f => f.id === item.id);
        document.getElementById('favBtn').innerText = isFav ? "âœ…" : "â¤ï¸";
        loadSimilar(item.title ? 'movie' : 'tv', item.id);
        if (item.name) { 
            document.getElementById('tvSelectors').style.display = 'block'; 
            loadSeasons(item.id); 
        } else { 
            document.getElementById('tvSelectors').style.display = 'none'; 
        }
    }

    async function loadSeasons(id) {
        const res = await fetch(`/api/movies?type=tv&id=${id}&lang=${currentLang}`);
        const data = await res.json();
        if(data.seasons) {
            document.getElementById('seasonsGrid').innerHTML = data.seasons.filter(s => s.season_number > 0).map(s => `<div class="btn-item ${s.season_number==1?'selected':''}" onclick="selectS(${s.season_number}, this)">S${s.season_number}</div>`).join('');
            selectS(1);
        }
    }

    async function selectS(sNum, el) {
        selectedS = sNum;
        if(el) { document.querySelectorAll('#seasonsGrid .btn-item').forEach(b => b.classList.remove('selected')); el.classList.add('selected'); }
        const res = await fetch(`/api/movies?type=tv&id=${currentItem.id}&season=${sNum}&lang=${currentLang}`);
        const data = await res.json();
        if(data.episodes) {
            document.getElementById('episodesGrid').innerHTML = data.episodes.map(e => `<div class="btn-item" onclick="selectE(${e.episode_number}, this)">E${e.episode_number}</div>`).join('');
        }
    }

    function selectE(eNum, el) {
        selectedE = eNum;
        document.querySelectorAll('#episodesGrid .btn-item').forEach(b => b.classList.remove('selected'));
        el.classList.add('selected');
    }

    async function loadSimilar(type, id) {
        const res = await fetch(`/api/movies?type=${type}&id=${id}&lang=${currentLang}&similar=true`);
        const data = await res.json();
        if(data.results) {
            document.getElementById('similarGrid').innerHTML = data.results.slice(0, 10).map(s => `<div class="similar-card" onclick='showDetails(${JSON.stringify(s).replace(/'/g, "&apos;")})'><img src="https://image.tmdb.org/t/p/w185${s.poster_path}"></div>`).join('');
        }
    }

    function watchNow() {
        if (!history.some(i => i.id === currentItem.id)) { 
            history.unshift(currentItem); 
            localStorage.setItem('monoflix_history', JSON.stringify(history.slice(0, 24))); 
        }
        const lastWatched = { ...currentItem, s: selectedS, e: selectedE, time: new Date().getTime() };
        localStorage.setItem('monoflix_last', JSON.stringify(lastWatched));
        document.getElementById('videoLayer').style.display = 'flex';
        switchServer();
        showContinueWatching();
    }

    function showContinueWatching() {
        const last = JSON.parse(localStorage.getItem('monoflix_last'));
        const container = document.getElementById('continueGrid');
        const title = document.getElementById('continueTitle');
        if (last && container && title) {
            title.style.display = 'block';
            container.style.display = 'flex';
            const info = last.title ? '' : ` - S${last.s} E${last.e}`;
            container.innerHTML = `<div class="btn-nav active" onclick='showDetails(${JSON.stringify(last).replace(/'/g, "&apos;")})' style="background: linear-gradient(90deg, #e50914, #000); border: 1px solid var(--red);">â–¶ Ø§Ø³ØªÙƒÙ…Ø§Ù„: ${last.title || last.name}${info}</div>`;
        }
    }
function switchServer() {
    const type = currentItem.title ? 'movie' : 'tv';
    const id = currentItem.id;
    const s = selectedS || 1;
    const e = selectedE || 1;
    const sVal = document.getElementById('serverSelect').value;
    let url = '';

    switch(sVal) {
        // Ø§Ù„Ø³ÙŠØ±ÙØ± Ø§Ù„Ø£ÙˆÙ„ (Ø´ØºØ§Ù„ Ø¹Ù†Ø¯Ùƒ)
        case 'vidsrc_me': 
            url = `https://vidsrc.me/embed/${type}?tmdb=${id}${type==='tv' ? `&season=${s}&episode=${e}` : ''}`;
            break;

        // Ø¨Ø¯ÙŠÙ„ Ø¬Ø¯ÙŠØ¯ ÙˆÙ‚ÙˆÙŠ Ø¬Ø¯Ø§Ù‹ (ØºØ§Ù„Ø¨Ø§Ù‹ Ù„Ø§ ÙŠÙØ­Ø¬Ø¨)
        case 'uqload':
            url = `https://vidsrc.xyz/embed/${type}/${id}${type==='tv' ? `/${s}/${e}` : ''}`;
            break;
        // Ø³ÙŠØ±ÙØ± SuperEmbed - Ù…Ø³ØªÙ‚Ø± Ø¬Ø¯Ø§Ù‹
        case 'superembed': 
            url = `https://multiembed.mov/?video_id=${id}${type==='tv' ? `&s=${s}&e=${e}` : ''}&tmdb=1`;
            break;

        // Ø³ÙŠØ±ÙØ± SmashyStream - Ø¨Ø¯ÙŠÙ„ Ø§Ø­ØªØ±Ø§ÙÙŠ
        case 'smashy':
            url = `https://embed.smashystream.com/playere.php?tmdb=${id}${type==='tv' ? `&season=${s}&episode=${e}` : ''}`;
            break;

        // Ø§Ù„Ø³ÙŠØ±ÙØ± Ø§Ù„Ø£Ø®ÙŠØ± (Ø´ØºØ§Ù„ Ø¹Ù†Ø¯Ùƒ)
        case '2embed': 
            url = `https://www.2embed.cc/embed/${id}${type==='tv' ? `&s=${s}&e=${e}` : ''}`;
            break;
    }

    const iframe = document.getElementById('mainIframe');
    if (iframe) {
        iframe.src = url;
    }
}
function downloadNow() {
    const type = currentItem.title ? 'movie' : 'tv';
    const id = currentItem.id;
    const s = selectedS || 1;
    const e = selectedE || 1;

    // Ø±Ø§Ø¨Ø· ÙŠÙØªØ­ ÙˆØ§Ø¬Ù‡Ø© ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ "Ø£Ø²Ø±Ø§Ø± ØªØ­Ù…ÙŠÙ„" Ø­Ù‚ÙŠÙ‚ÙŠØ© Ù„Ù„Ø³ÙŠØ±ÙØ±Ø§Øª Ø§Ù„ØªÙŠ Ø·Ù„Ø¨ØªÙ‡Ø§
    let downloadUrl = `https://www.2embed.cc/embed/${id}${type==='tv' ? `&s=${s}&e=${e}` : ''}`;

    window.open(downloadUrl, '_blank');
}
    function toggleWatchlist() {
        const idx = watchlist.findIndex(f => f.id === currentItem.id);
        if(idx === -1) { watchlist.push(currentItem); document.getElementById('favBtn').innerText = "âœ…"; }
        else { watchlist.splice(idx, 1); document.getElementById('favBtn').innerText = "â¤ï¸"; }
        localStorage.setItem('monoflix_fav', JSON.stringify(watchlist));
    }

    function showWatchlist(e) { currentGenre = 'watchlist'; updateNav(e); render(watchlist, false); }
    function showHistory(e) { currentGenre = 'history'; updateNav(e); render(history, false); }
    function changeCategory(g, e) { currentGenre = g; currentPage = 1; updateNav(e); loadMovies(); }
    function updateNav(e) { document.querySelectorAll('.btn-nav').forEach(b => b.classList.remove('active')); e.target.classList.add('active'); }
    function closeModal(id) { document.getElementById(id).style.display = 'none'; document.body.style.overflow = 'auto'; if(id === 'videoLayer') document.getElementById('mainIframe').src = ''; }

    function changeLanguage() {
        currentLang = document.getElementById('langToggle').value;
        localStorage.setItem('monoflix_lang', currentLang);
        applyLang();
        loadMovies();
    }

    document.getElementById('searchInput').oninput = async (e) => {
        if(e.target.value.length < 3) return;
        try {
            const res = await fetch(`/api/movies?query=${encodeURIComponent(e.target.value)}&lang=${currentLang}`);
            const data = await res.json();
            render(data.results, false);
        } catch(e) {}
    };

    function copyLink() {
        const link = window.location.href;
        navigator.clipboard.writeText(link).then(() => alert("ØªÙ… Ù†Ø³Ø® Ø±Ø§Ø¨Ø· Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¨Ù†Ø¬Ø§Ø­!"));
    }

    window.onscroll = () => { 
        if ((window.innerHeight + window.scrollY) >= document.body.offsetHeight - 800 && !isFetching && currentGenre !== 'watchlist' && currentGenre !== 'history') { 
            currentPage++; 
            loadMovies(true); 
        } 
    };

    window.onload = () => { applyLang(); loadMovies(); showContinueWatching(); };
</script>
</body>
</html>